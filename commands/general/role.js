const { SlashCommandBuilder } = require('@discordjs/builders');
const { MessageAttachment } = require('discord.js');

const { Resvg } = require('@resvg/resvg-js');

module.exports = {
    data: new SlashCommandBuilder()
        .setName('role')
        .setDescription('Shows a role\'s information')
        .addRoleOption(option =>
            option.setName('role')
                .setDescription('Select a role')
                .setRequired(true),
        ),

    async execute(interaction) {
        const { client } = interaction;
        const role = interaction.options.getRole('role');

        const isMentionable = role.mentionable ? 'Yes' : 'No';
        const isDisplayedSeparately = role.hoist ? 'Yes' : 'No';

        const svgStr = `
        <svg width="128" height="128" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M11.3137 75.3137C5.06531 69.0653 5.06532 58.9347 11.3137 52.6863L18.7452 45.2548V34.7452C18.7452 25.9086 25.9086 18.7452 34.7452 18.7452H45.2548L52.6863 11.3137C58.9347 5.06531 69.0653 5.06532 75.3137 11.3137L82.7452 18.7452H93.2549C102.091 18.7452 109.255 25.9086 109.255 34.7452V45.2548L116.686 52.6863C122.935 58.9347 122.935 69.0653 116.686 75.3137L109.255 82.7452V93.2548C109.255 102.091 102.091 109.255 93.2548 109.255H82.7452L75.3137 116.686C69.0653 122.935 58.9347 122.935 52.6863 116.686L45.2548 109.255H34.7452C25.9086 109.255 18.7452 102.091 18.7452 93.2548V82.7452L11.3137 75.3137ZM58.9063 87C60.4688 87 61.4896 87.0833 61.9688 87.25C62.3021 86.8333 62.4688 86.1458 62.4688 85.1875C62.4688 84.625 62.1563 84.1771 61.5313 83.8437C61.2188 83.6771 60.8333 83.5417 60.375 83.4375C59.9375 83.3125 59.4792 83.1979 59 83.0937C58.5208 82.9896 58.1354 82.875 57.8438 82.75C56.9271 82.3125 56.4688 81.2708 56.4688 79.625V47.7188C56.5104 45.7396 56.9479 44.3958 57.7813 43.6875C58.6146 42.9375 60.2813 42.5625 62.7813 42.5625C66.5729 42.6042 
                  69.5313 43.6354 71.6563 45.6563C73.5313 47.4479 74.4688 49.75 74.4688 52.5625C74.4688 55.9167 73.3958 58.5208 71.25 60.375C70.1458 61.3125 68.7396 62.0521 67.0313 62.5938C65.3438 63.1354 63.8229 63.4271 62.4688 63.4688C61.1146 63.4896 60.3021 63.5938 60.0313 63.7813C59.2396 64.3646 58.8438 65.1771 58.8438 66.2188C58.8438 66.9688 59.1042 67.3438 59.625 67.3438H62.7813C63.4271 67.3438 64.1354 67.7396 64.9063 68.5313C65.6979 69.3021 66.75 71.0417 68.0625 73.75L69.9063 77.4687C70.5729 78.7396 71.2813 79.9792 72.0313 81.1875C72.8021 82.3958 73.6458 83.4792 74.5625 84.4375C75.5 85.375 76.5208 86.1354 77.625 86.7187C78.75 87.3021 80.1771 87.5937 81.9063 87.5937C83.6354 87.5937 85.2292 87.0625 86.6875 86C87.3333 85.5417 87.8333 85.0312 88.1875 84.4687C88.5417 83.8854 88.7188 83.3854 88.7188 82.9687C88.7188 82.5521 88.6042 82.1875 88.375 81.875C88.1458 81.5417 87.9271 81.375 87.7188 81.375C87.5104 81.375 87.3229 81.4062 87.1563 81.4687L86.375 81.7812C85.9792 81.9271 85.3958 82 84.625 82C82.5833 82 80.0104 79.7396 76.9063 75.2187L73.5938 70.375C72.2188 68.375 70.9896 67 69.9063 
                  66.25C73.8646 65.2292 76.9688 63.2708 79.2188 60.375C81.2396 57.7708 82.25 54.9167 82.25 51.8125C82.25 47.6667 80.6563 44.4583 77.4688 42.1875C74.2813 39.8958 69.4792 38.75 63.0625 38.75L61.7188 38.7813L50.75 39.0938H46.6875C45.1042 39.0938 44.0729 39.0104 43.5938 38.8438C43.2604 39.2604 43.0938 39.9583 43.0938 40.9375C43.0938 41.4792 43.4063 41.9167 44.0313 42.25C44.3438 42.4167 44.7188 42.5625 45.1563 42.6875L46.5313 43C47.0104 43.1042 47.3854 43.2188 47.6563 43.3438C48.5521 43.7396 49.0313 44.6667 49.0938 46.125V78.0937C49.0938 80.0312 48.7813 81.4167 48.1563 82.25C47.8438 82.6458 47.4792 82.9271 47.0625 83.0937C46.6458 83.2396 46.0729 83.3125 45.3438 83.3125C44.6146 83.3125 43.8542 83.2083 43.0625 83C42.75 83.3958 42.5938 83.9271 42.5938 84.5937C42.5938 85.5104 42.9167 86.1458 43.5625 86.5C44.2083 86.8333 45.0729 87 46.1563 87H58.9063Z" fill="${role.hexColor}" />
          </g>
        </svg>
        `;

        const pngBuffer = new Resvg(svgStr).render().asPng();

        const fileName = `${role.id}.png`;
        const attachment = new MessageAttachment(pngBuffer, fileName);

        const embed = new client.bot.embeds.DefaultEmbed(client)
            .setTitle(`Role information - ${role.name}`)
            .setThumbnail(`attachment://${fileName}`)
            .addField('Name', role.toString(), true)
            .addField('Color', role.hexColor, true)
            .addField('ID', role.id, true)
            .addField('Created At', client.bot.formatter.formatDate(role.createdAt), true)
            .addField('Mentionable', isMentionable, true)
            .addField('Displayed Separately', isDisplayedSeparately, true);

        await interaction.reply({ embeds: [embed], files: [attachment] });
    },
};
